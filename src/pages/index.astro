---
import Layout from "../layouts/Layout.astro";
import Header from "../components/Header.astro";
import CategorySection from "../components/CategorySection.astro";
import CartFloatingButton from "../components/CartFloatingButton.astro";
import ModalExtras from "../components/ModalExtras.astro";
import { getMenuData, getExtras } from "../lib/googleSheets";

const menuData = await getMenuData();
const extrasData = await getExtras();
---

<Layout>
  <Header />

  <!-- ===== HERO — FULL-WIDTH IMAGE BANNER ===== -->
  <div
    class="hero-banner relative overflow-hidden"
    style="background: #0D0D0D; border-bottom: 3px solid #E8681A;"
  >
    <!-- Hero image -->
    <img
      src="/img/hero-burger.jpg"
      alt="Branco Burgers — hamburguesa artesanal"
      class="hero-img"
    />

    <!-- Dark gradient overlay (bottom) -->
    <div class="hero-overlay"></div>

    <!-- Grain texture overlay -->
    <div
      class="absolute inset-0 pointer-events-none"
      style={`background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='300'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.12'/%3E%3C/svg%3E"); background-size:300px 300px; mix-blend-mode: overlay;`}
    >
    </div>

    <!-- Tagline over the image -->
    <div class="hero-tagline">
      <div class="hero-tagline-inner">
        <div class="hero-line"></div>
        <p class="hero-text">ELEGÍ &bull; PEDÍ &bull; DISFRUTÁ</p>
        <div class="hero-line"></div>
      </div>
    </div>

    <!-- Orange bottom stripe -->
    <div
      class="w-full h-1"
      style="background: linear-gradient(90deg, #E8681A, #B84E10, #E8681A); position: relative; z-index: 3;"
    >
    </div>
  </div>

  <!-- ===== CATEGORY NAVIGATION PILLS ===== -->
  <nav
    class="theme-nav sticky top-[80px] z-40 py-2.5 overflow-x-auto no-scrollbar"
    style="backdrop-filter: blur(12px); background: rgba(245, 240, 232, 0.85); border-bottom: 2px solid #0D0D0D;"
  >
    <div class="flex gap-2 px-4 w-max min-w-full">
      {
        menuData.map((cat) => (
          <a
            href={`#${cat.id}`}
            class="flex-shrink-0 px-3.5 py-1.5 text-xs font-bold transition-all duration-200 whitespace-nowrap theme-pill-inactive"
            style="font-family: 'Bebas Neue', sans-serif; font-size: 0.85rem; letter-spacing: 0.05em;"
            data-nav-pill={cat.id}
          >
            {cat.category}
          </a>
        ))
      }
    </div>
  </nav>

  <!-- ===== MENU ===== -->
  <main class="pb-32 max-w-4xl mx-auto pt-3">
    {
      menuData.map((category) => (
        <CategorySection
          id={category.id}
          category={category.category}
          emoji={category.emoji}
          categoryKey={category.category}
          products={category.products}
        />
      ))
    }
  </main>

  <ModalExtras />
  <CartFloatingButton />
</Layout>

<style is:global>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  /* ===== HERO BANNER ===== */
  .hero-banner {
    position: relative;
    width: 100%;
    height: 280px;
  }

  .hero-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center 35%;
    display: block;
  }

  .hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      rgba(13, 13, 13, 0.15) 0%,
      rgba(13, 13, 13, 0.3) 40%,
      rgba(13, 13, 13, 0.85) 80%,
      rgba(13, 13, 13, 0.95) 100%
    );
    z-index: 1;
  }

  .hero-tagline {
    position: absolute;
    bottom: 16px;
    left: 0;
    right: 0;
    z-index: 2;
    padding: 0 20px;
  }

  .hero-tagline-inner {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .hero-line {
    flex: 1;
    height: 1px;
    background: rgba(232, 104, 26, 0.5);
  }

  .hero-text {
    font-family: "Bebas Neue", sans-serif;
    color: #f5f0e8;
    font-size: 0.9rem;
    letter-spacing: 0.2em;
    white-space: nowrap;
    margin: 0;
  }

  @media (min-width: 640px) {
    .hero-banner {
      height: 360px;
    }
    .hero-text {
      font-size: 1.1rem;
      letter-spacing: 0.25em;
    }
  }

  @media (min-width: 1024px) {
    .hero-banner {
      height: 420px;
    }
  }
</style>

<!-- Inject extras data into the global scope for the ModalExtras component -->
<script define:vars={{ extrasData }}>
  window.__BRANCO_EXTRAS__ = extrasData;
</script>

<script>
  const sections = document.querySelectorAll("section[id]");
  const pills = document.querySelectorAll("[data-nav-pill]");

  // Active pill: orange bg, black text, black border
  const activeStyle = {
    bg: "#E8681A",
    color: "#0D0D0D",
    border: "2px solid #0D0D0D",
    shadow: "2px 2px 0px #0D0D0D",
  };
  const inactiveStyle = {
    bg: "#F5F0E8",
    color: "#6B6660",
    border: "2px solid #0D0D0D",
    shadow: "none",
  };

  function setActivePill(id: string) {
    pills.forEach((pill) => {
      const el = pill as HTMLElement;
      const s = el.dataset.navPill === id ? activeStyle : inactiveStyle;
      el.style.background = s.bg;
      el.style.color = s.color;
      el.style.border = s.border;
      el.style.boxShadow = s.shadow;

      if (el.dataset.navPill === id) {
        el.scrollIntoView({
          behavior: "smooth",
          block: "nearest",
          inline: "center",
        });
      }
    });
  }

  if (pills.length > 0) {
    const first = pills[0] as HTMLElement;
    first.style.background = "#E8681A";
    first.style.color = "#0D0D0D";
    first.style.border = "2px solid #0D0D0D";
    first.style.boxShadow = "2px 2px 0px #0D0D0D";
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) setActivePill(entry.target.id);
      });
    },
    { rootMargin: "-20% 0px -60% 0px" }
  );

  sections.forEach((section) => observer.observe(section));
</script>
