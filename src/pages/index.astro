---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import CategorySection from '../components/CategorySection.astro';
import CartFloatingButton from '../components/CartFloatingButton.astro';
import { getMenuData } from '../lib/googleSheets';

const menuData = await getMenuData();
---

<Layout>
  <Header />

  <!-- Category navigation pills -->
  <nav
    class="theme-nav sticky top-[72px] z-40 py-2.5 overflow-x-auto"
    style="backdrop-filter: blur(12px);"
  >
    <div class="flex gap-2 px-4 w-max min-w-full">
      {menuData.map((cat) => (
        <a
          href={`#${cat.id}`}
          class="flex-shrink-0 px-3.5 py-1.5 rounded-full text-xs font-bold transition-all duration-200 whitespace-nowrap theme-pill-inactive"
          data-nav-pill={cat.id}
        >
          {cat.emoji} {cat.category.split(' ').slice(1).join(' ')}
        </a>
      ))}
    </div>
  </nav>

  <!-- Hero banner -->
  <div
    class="relative overflow-hidden mx-4 mt-4 mb-5 rounded-2xl p-5"
    style="background: linear-gradient(135deg, #1A1A1A 0%, #111111 50%, #0D0D0D 100%); border: 1px solid rgba(232,104,26,0.35);"
  >
    <div class="relative z-10">
      <div class="flex items-center gap-2 mb-1">
        <div class="w-3 h-0.5 rounded-full" style="background: #E8681A;"></div>
        <p class="text-xs font-black uppercase tracking-widest" style="color: #E8681A;">ğŸ” MenÃº Digital</p>
      </div>
      <h1 class="text-2xl font-black leading-tight mb-1.5" style="color: #F5F5F0;">
        Â¡Bienvenido a<br/>
        <span style="color: #E8681A;">Branco Burgers!</span>
      </h1>
      <p class="text-xs" style="color: rgba(245,245,240,0.60);">
        ElegÃ­, armÃ¡ tu pedido y enviÃ¡lo por WhatsApp ğŸš€
      </p>
    </div>
    <!-- Decorative circles â€” orange glow -->
    <div class="absolute -right-6 -top-6 w-28 h-28 rounded-full opacity-15" style="background: #E8681A;"></div>
    <div class="absolute right-8 -bottom-8 w-20 h-20 rounded-full opacity-8" style="background: #FF8C42;"></div>
  </div>

  <!-- Menu categories -->
  <main class="pb-32 max-w-4xl mx-auto">
    {menuData.map((category) => (
      <CategorySection
        id={category.id}
        category={category.category}
        emoji={category.emoji}
        products={category.products}
      />
    ))}
  </main>

  <CartFloatingButton />
</Layout>

<script>
  const sections = document.querySelectorAll('section[id]');
  const pills = document.querySelectorAll('[data-nav-pill]');

  // Branco active pill: electric orange bg, dark text
  const activeStyle = { bg: '#E8681A', color: '#0D0D0D' };
  const inactiveStyle = { bg: '#242424', color: '#888880' };

  function setActivePill(id: string) {
    pills.forEach((pill) => {
      const el = pill as HTMLElement;
      if (el.dataset.navPill === id) {
        el.style.background = activeStyle.bg;
        el.style.color = activeStyle.color;
      } else {
        el.style.background = inactiveStyle.bg;
        el.style.color = inactiveStyle.color;
      }
    });
  }

  // Set first pill active by default
  if (pills.length > 0) {
    const firstPill = pills[0] as HTMLElement;
    firstPill.style.background = '#E8681A';
    firstPill.style.color = '#0D0D0D';
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) setActivePill(entry.target.id);
      });
    },
    { rootMargin: '-20% 0px -60% 0px' }
  );

  sections.forEach((section) => observer.observe(section));
</script>
